

è¦ç†è§£ **impermanent lossï¼ˆILï¼Œéæ°¸ä¹…æ€§æŸå¤±ï¼‰**ï¼Œå¿…é¡»å…ˆå¼„æ¸…æ¥šï¼šä½œä¸º Liquidity Provider (LP)ï¼Œä½ åœ¨ AMM æ± é‡Œâ€œèµšçš„æ˜¯ä»€ä¹ˆâ€ï¼Œä»¥åŠâ€œä¸ºä»€ä¹ˆä¼šå‡ºç°å’Œå•çº¯æŒæœ‰ä¸åŒçš„ç»“æœâ€ã€‚

---

## 1. LP çš„è·åˆ©æ¥æº

å½“ä½ å¾€ AMM æ± é‡Œå­˜å…¥æµåŠ¨æ€§ï¼ˆæ¯”å¦‚ 1 BTC + \$100,000 ç¨³å®šå¸ï¼Œå‡è®¾ BTC å½“æ—¶ä»·æ ¼æ­£å¥½æ˜¯ \$100,000ï¼‰ï¼Œä½ ä¼šæ”¶åˆ° LP Tokenã€‚è¿™ä¸ª LP Token ä»£è¡¨ä½ åœ¨æ± å­ä¸­çš„ **ä»½é¢**ã€‚
ä½ ä½œä¸º LP çš„æ”¶å…¥ä¸»è¦æ¥è‡ªï¼š

1. **äº¤æ˜“æ‰‹ç»­è´¹**

   * æ± å­é‡Œæœ‰ç”¨æˆ·ä¸æ–­åœ¨ BTC â†” ç¨³å®šå¸ä¹‹é—´åšäº¤æ˜“ã€‚
   * æ¯ä¸€ç¬”äº¤æ˜“è¦ä»˜äº¤æ˜“è´¹ï¼ˆä¾‹å¦‚ 0.04%ï¼‰ã€‚
   * è¿™äº›è´¹ç”¨æŒ‰æ¯”ä¾‹åˆ†ç»™ LPï¼Œæ‰€ä»¥äº¤æ˜“é‡è¶Šå¤§ã€æ± å­è¶Šæ·±ï¼Œæ”¶ç›Šè¶Šå¤šã€‚

2. **å¯èƒ½çš„æ¿€åŠ± / æŒ–çŸ¿å¥–åŠ±**

   * æœ‰çš„æ± å­ä¼šé¢å¤–å‘æ”¾å¥–åŠ±ï¼ˆä¾‹å¦‚ CRVã€æ²»ç†ä»£å¸ç­‰ï¼‰ï¼Œä½œä¸ºè¡¥è´´ã€‚

æ‰€ä»¥ï¼š**LP å¹¶ä¸æ˜¯é€šè¿‡èµ„äº§ä»·æ ¼ä¸Šæ¶¨æœ¬èº«èµšé’±çš„ï¼Œè€Œæ˜¯é€šè¿‡â€œåˆ«äººäº¤æ˜“ä»˜è´¹â€èµšé’±çš„ã€‚**

---

## 2. ä¸ºä»€ä¹ˆä¼šå‡ºç° Impermanent Lossï¼ˆILï¼‰

Impermanent loss æ˜¯å’Œ **â€œå¦‚æœæˆ‘åªæ˜¯å•çº¯æŒæœ‰ï¼ˆHODLï¼‰â€** ç›¸æ¯”ï¼ŒLP çš„èµ„äº§ä»·å€¼å°‘äº†å¤šå°‘ã€‚

æ ¹æºåœ¨äº AMM çš„è‡ªåŠ¨å†å¹³è¡¡æœºåˆ¶ï¼š

* æ± å­ä½¿ç”¨å…¬å¼ï¼ˆæ¯”å¦‚å¸¸è§çš„ `x * y = k`ï¼‰ä¿æŒä¸¤è¾¹èµ„äº§çš„æ¯”ä¾‹ã€‚
* å½“ BTC ä»·æ ¼ä¸Šæ¶¨æ—¶ï¼Œå¥—åˆ©è€…ä¼šä¸æ–­ä¹°èµ° BTCã€æ”¾è¿›ç¨³å®šå¸ï¼Œè®©æ± å­ä»·æ ¼å’Œå¤–éƒ¨å¸‚åœºå¯¹é½ã€‚
* ç»“æœï¼š**æ± å­é‡Œçš„ BTC æ•°é‡ä¼šè¶Šæ¥è¶Šå°‘ï¼Œç¨³å®šå¸æ•°é‡è¶Šæ¥è¶Šå¤š**ã€‚
* å½“ä½ å–å‡ºæµåŠ¨æ€§æ—¶ï¼Œä½ å¾—åˆ°çš„ **BTC æ¯”å•çº¯æŒæœ‰æ—¶æ›´å°‘**ï¼Œ**ç¨³å®šå¸æ¯”å•çº¯æŒæœ‰æ—¶æ›´å¤š**ã€‚

è¿™å°±æ˜¯ ILï¼šä½ â€œé”™è¿‡äº†â€å¦‚æœå•çº¯æ‹¿ç€ BTCï¼Œæœ¬å¯ä»¥è·å¾—æ›´å¤šæ¶¨å¹…çš„æ”¶ç›Šã€‚

---

## 3. ä¸¾ä¸ªä¾‹å­

åˆå§‹æ¡ä»¶ï¼š

* ä½ å­˜å…¥ **1 BTC + \$100,000 USDC**ï¼ŒBTC å½“æ—¶ä»·æ ¼ = \$100,000ã€‚
* æ± å­ä¸€å¼€å§‹æ€»é‡ï¼š10 BTC + \$1,000,000 USDCï¼ˆå‡è®¾ï¼‰ã€‚

ä½ å æ± å­ **10% ä»½é¢**ã€‚

---

### æƒ…å†µ Aï¼šBTC ä»·æ ¼ä¸åŠ¨

* ä½ ä¸€ç›´æ‹¿ç€ LP Tokenï¼Œæœ€åæ‹¿å›ç›¸åŒæ•°é‡çš„ BTC+USDCï¼ŒåŠ ä¸Šäº¤æ˜“è´¹æ”¶ç›Šã€‚
* æ²¡æœ‰ ILï¼Œèµšçš„å°±æ˜¯æ‰‹ç»­è´¹ã€‚

---

### æƒ…å†µ Bï¼šBTC ç¿»å€åˆ° \$200,000

* **å•çº¯æŒæœ‰**ï¼šä½ çš„èµ„äº§ = 1 BTC (\$200k) + \$100k = **\$300k**ã€‚
* **åš LP**ï¼šæ± å­ä¼šä¸æ–­è¢«å¥—åˆ©è°ƒæ•´ï¼Œæœ€ç»ˆæ¯”ä¾‹ä¼šæ¥è¿‘ 50% BTC + 50% USDCã€‚

  * ä½ å–å‡ºæ—¶ï¼Œå¤§çº¦å¾—åˆ° **0.707 BTC + \$141,000 USDC â‰ˆ \$283,000**ã€‚
* å·®é¢ â‰ˆ **\$17k (5.7%)**ï¼Œå°±æ˜¯ ILã€‚
* ä¸è¿‡åœ¨æ­¤æœŸé—´ï¼Œä½ è¿˜èµšäº†äº¤æ˜“è´¹ï¼ˆæ¯”å¦‚å‡ åƒç¾é‡‘ï¼‰ã€‚å¦‚æœæ‰‹ç»­è´¹æ”¶å…¥ > 17kï¼Œé‚£ä¹ˆæ•´ä½“è¿˜æ˜¯æ­£æ”¶ç›Šã€‚

---

### æƒ…å†µ Cï¼šBTC è·Œåˆ° \$50,000

* **å•çº¯æŒæœ‰**ï¼š1 BTC (\$50k) + \$100k = **\$150k**ã€‚
* **åš LP**ï¼šæ± å­å†å¹³è¡¡åï¼Œä½ ä¼šå¾—åˆ°æ›´å¤š BTCï¼ˆå¤§çº¦ 1.414 BTC + \$70,700 USDC â‰ˆ \$141kï¼‰ã€‚
* å·®é¢ â‰ˆ -\$9k (â‰ˆ -6%)ï¼Œä¾ç„¶æ˜¯ ILã€‚
* ä½†ä¸€æ ·ï¼Œå¯èƒ½æ‰‹ç»­è´¹å¼¥è¡¥ã€‚

---

## 4. å°ç»“

* **ä¸ºä»€ä¹ˆæœ‰ IL**ï¼šå› ä¸º AMM æ± è¦ä¿æŒä¸¤è¾¹èµ„äº§çš„å¹³è¡¡ï¼Œå½“ä»·æ ¼å˜åŠ¨æ—¶ï¼Œä½ çš„èµ„äº§é…ç½®ä¼šè¢«åŠ¨å†å¹³è¡¡ï¼Œå¯¼è‡´ç›¸å¯¹â€œå•çº¯æŒæœ‰â€å°‘èµšï¼ˆæ¶¨çš„æ—¶å€™å°‘èµšï¼Œè·Œçš„æ—¶å€™åè€Œå¤šæ‹¿ BTCï¼Œä½†ä»·å€¼è¿˜æ˜¯ä½ï¼‰ã€‚
* **LP å¦‚ä½•è·åˆ©**ï¼šé  **æ‰‹ç»­è´¹ + å¥–åŠ±** æ¥å¼¥è¡¥ ILï¼Œå¦‚æœäº¤æ˜“è¶³å¤Ÿé¢‘ç¹ï¼Œæ‰‹ç»­è´¹æ”¶å…¥å°±èƒ½ç›–è¿‡ ILï¼Œä»è€Œè·å¾—å‡€æ”¶ç›Šã€‚

---

ğŸ‘‰ æ‰€ä»¥å½“ä½ æä¾›æµåŠ¨æ€§æ—¶ï¼Œä½ æœ¬è´¨ä¸Šæ˜¯åœ¨**æ‹¿èµ„äº§ä»·æ ¼é£é™© + æ‰¿æ‹… IL**ï¼Œæ¢å–**äº¤æ˜“è´¹æ”¶ç›Š**ã€‚

ä¸‹é¢ä¸€æ®µå›¾ç‰‡èƒ½æ›´åŠ ç›´è§‚åœ°å¯¹æ¯”LPåœ¨å°†èµ„äº§æ”¾å…¥æµåŠ¨æ€§æ± æ—¶å’Œç›´æ¥HOLDæ—¶å…¶portfolioçš„ä»·å€¼å¯¹æ¯”ã€‚å¯ä»¥çœ‹åˆ°LPçš„å¤´å¯¸ä¸Pæ˜¯å‘ˆç°ä¸€ä¸ªâˆšpçš„å…³ç³»



![alt text](../../resources/ImermanentLoss-Example.png)
```python
# plotting LP vs HODL value for a constant-product AMM (no fees) and presenting a small table
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from math import sqrt
# helper from the jupyter tools (available in this environment)
try:
    from caas_jupyter_tools import display_dataframe_to_user
except Exception as e:
    display_dataframe_to_user = None

# Parameters (the example you gave)
btc0 = 1.0               # initial BTC provided by the LP
usd0 = 100000.0          # initial USD/stablecoin provided by the LP
p0 = usd0 / btc0         # initial price USD per BTC (100,000)
k = btc0 * usd0          # constant-product k

# price multipliers relative to p0 (we'll sweep from down 0.2x to up 2.0x)
multipliers = np.linspace(0.2, 2.0, 181)  # step 0.01 roughly
prices = p0 * multipliers

# compute new reserves for a constant-product AMM after price change
rb_new = np.sqrt(k / prices)      # BTC reserve after price change (if pool sole reserves = user's deposit)
ru_new = np.sqrt(k * prices)      # USD reserve after price change

# values
lp_values = rb_new * prices + ru_new           # value of LP holdings (BTC*price + USD)
hodl_values = btc0 * prices + usd0             # value if we just held BTC+USD

# impermanent loss (fractional)
il_fraction = (lp_values - hodl_values) / hodl_values

# package into dataframe for a few highlighted points
highlight_multipliers = [0.5, 0.70710678, 1.0, 1.41421356, 2.0]  # some canonical points including sqrt(2)
rows = []
for m in highlight_multipliers:
    p = p0 * m
    rb = sqrt(k / p)
    ru = sqrt(k * p)
    lp_val = rb * p + ru
    hodl_val = btc0 * p + usd0
    il_pct = (lp_val - hodl_val) / hodl_val * 100
    rows.append({
        "multiplier": m,
        "price": p,
        "btc_withdrawn": rb,
        "usd_withdrawn": ru,
        "LP_value": lp_val,
        "HODL_value": hodl_val,
        "IL_percent": il_pct
    })
df_highlight = pd.DataFrame(rows)

# full table for display (sampled every 10th point to keep size reasonable)
sample_df = pd.DataFrame({
    "multiplier": multipliers,
    "price": prices,
    "LP_value": lp_values,
    "HODL_value": hodl_values,
    "IL_percent": il_fraction * 100
})
sample_df_sampled = sample_df.iloc[::10].reset_index(drop=True)

# Plot (single figure) - do not set colors or styles explicitly
fig, ax = plt.subplots(figsize=(9,5))
ax.plot(multipliers, hodl_values, label="HODL value (1 BTC + $100k)")
ax.plot(multipliers, lp_values, label="LP value (constant-product, no fees)")
ax.set_xlabel("Price multiplier (relative to initial price)")
ax.set_ylabel("Portfolio value (USD)")
ax.set_title("HODL vs LP value for 1 BTC + $100k in a constant-product AMM (no fees)")
ax.legend()
ax.grid(True)

# show the figure (this cell's output will include the plot)
plt.tight_layout()
plt.show()

# display the highlighted table to the user via the interactive dataframe helper when available
if display_dataframe_to_user is not None:
    display_dataframe_to_user("Highlighted values for selected price multipliers", df_highlight)

# also return the sampled numeric table as output
sample_df_sampled.head(40)


```

